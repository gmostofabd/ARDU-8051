<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ARDU-8051 Virtual Lab | Push Button with Debounce</title>

<style>
:root{
  --primary:#1f3c88;
  --accent:#0a9396;
  --bg:#f4f6fb;
}

body{
  margin:0;
  font-family:Segoe UI, Roboto, Arial, sans-serif;
  background:var(--bg);
  color:#333;
}

/* ---------- HEADER ---------- */
header{
  background:linear-gradient(135deg,var(--primary),var(--accent));
  color:white;
  padding:1.8rem;
  text-align:center;
}

header h1{
  margin:0;
  font-size:1.8rem;
}

header p{
  margin-top:0.4rem;
  font-size:1rem;
}

/* ---------- LAYOUT ---------- */
section{
  max-width:1100px;
  margin:auto;
  padding:2rem 1.2rem;
}

.lab-container{
  display:flex;
  flex-wrap:wrap;
  gap:1.5rem;
}

/* ---------- CODE PANEL ---------- */
.code-panel{
  flex:1 1 420px;
}

.code-panel h2{
  color:var(--primary);
}

.code-box{
  background:#1e1e1e;
  color:#00ff90;
  padding:1rem;
  border-radius:10px;
  font-family:monospace;
  font-size:14px;
  min-height:280px;
  white-space:pre;
}

.highlight{
  background:#ffee58;
  color:#000;
}

.btn{
  padding:0.45rem 1rem;
  border:none;
  border-radius:6px;
  background:var(--primary);
  color:white;
  cursor:pointer;
  margin-right:0.4rem;
  margin-top:0.6rem;
}

.btn:hover{
  background:var(--accent);
}

.status-box{
  margin-top:0.8rem;
  background:#eef2ff;
  padding:0.6rem;
  border-radius:6px;
  font-family:monospace;
}

/* ---------- BOARD PANEL ---------- */
.board-panel{
  flex:1 1 420px;
}

.board-panel h2{
  color:var(--primary);
}

.board{
  position:relative;
  max-width:480px;
  margin:auto;
}

.board img{
  width:100%;
  border-radius:12px;
}

/* LED (P1.0) */
.led{
  position:absolute;
  left:63%;
  top:19%;
  width:26px;
  height:26px;
  border-radius:50%;
  background:#400;
  border:2px solid #222;
}

.led.on{
  background:red;
  box-shadow:0 0 16px red;
}

/* Push Button (P3.2 / INT0 style) */
.button{
  position:absolute;
  left:32%;
  top:48%;
  width:46px;
  height:46px;
  border-radius:50%;
  background:#ddd;
  border:3px solid #444;
  cursor:pointer;
}

.button:active,
.button.pressed{
  background:#aaa;
  box-shadow:inset 0 0 8px #000;
}

.panel{
  margin-top:0.8rem;
  background:#f7f9fc;
  padding:0.6rem;
  border-radius:6px;
  font-family:monospace;
}

/* ---------- FOOTER ---------- */
footer{
  text-align:center;
  font-size:0.85rem;
  padding:1.2rem;
  background:#111;
  color:#ccc;
}
</style>
</head>

<body>

<header>
  <h1>ARDU-8051 Virtual Lab</h1>
  <p>Experiment â€” Push Button with Software Debouncing</p>
</header>

<section>
<div class="lab-container">

<!-- ================= CODE SIDE ================= -->
<div class="code-panel">
<h2>8051 Assembly Program (Debounced Input)</h2>

<div id="code" class="code-box">
ORG 0000H
MAIN:
  JB  P3.2, MAIN     ; wait for button press (active LOW)
  ACALL DEBOUNCE
  CPL P1.0           ; toggle LED
WAIT_RELEASE:
  JNB P3.2, WAIT_RELEASE
  SJMP MAIN

DEBOUNCE:
  MOV R7,#50
D1:
  MOV R6,#255
D2:
  DJNZ R6,D2
  DJNZ R7,D1
  RET
END
</div>

<button class="btn" onclick="pressButton()">Press Button</button>
<button class="btn" onclick="resetLab()">Reset</button>

<div class="status-box">
Button (P3.2): <span id="btnState">1</span><br>
LED (P1.0): <span id="ledState">0</span>
</div>
</div>

<!-- ================= BOARD SIDE ================= -->
<div class="board-panel">
<h2>Hardware Visualization</h2>

<div class="board">
<img src="https://raw.githubusercontent.com/gmostofabd/ARDU-8051/main/docs/images/ARDU-8051-3D-1.png">

<div id="led" class="led"></div>
<div id="button" class="button"></div>
</div>

<div class="panel">
Port-1 (HEX): <span id="p1hex">00</span><br>
Port-3 (HEX): <span id="p3hex">FF</span>
</div>

<div class="panel">
<b>Concept:</b><br>
Mechanical switches bounce. The delay routine ensures
only a <b>single valid press</b> is detected.
</div>
</div>

</div>
</section>

<footer>
ARDU-8051 Open-Source Virtual Laboratory<br>
Maintainer: Md. Golam Mostofa
</footer>

<script>
let p1 = 0;
let p3 = 0xFF; // P3.2 high (not pressed)
let debounceLock = false;

const led = document.getElementById("led");
const button = document.getElementById("button");

function updateUI(){
  led.classList.toggle("on", p1 & 1);
  document.getElementById("ledState").innerText = p1 & 1;
  document.getElementById("btnState").innerText = (p3 >> 2) & 1;
  document.getElementById("p1hex").innerText = p1.toString(16).toUpperCase().padStart(2,"0");
  document.getElementById("p3hex").innerText = p3.toString(16).toUpperCase();
}

function pressButton(){
  if(debounceLock) return;

  debounceLock = true;
  button.classList.add("pressed");

  // simulate bounce
  let bounce = 6;
  const bounceTimer = setInterval(()=>{
    p3 ^= (1 << 2);
    updateUI();
    bounce--;
    if(bounce === 0){
      clearInterval(bounceTimer);
      p3 &= ~(1 << 2); // stable LOW
      debounceDelay();
    }
  },40);
}

function debounceDelay(){
  setTimeout(()=>{
    p1 ^= 1; // toggle LED
    updateUI();

    // release button
    setTimeout(()=>{
      p3 |= (1 << 2);
      button.classList.remove("pressed");
      debounceLock = false;
      updateUI();
    },300);
  },300);
}

function resetLab(){
  p1 = 0;
  p3 = 0xFF;
  debounceLock = false;
  button.classList.remove("pressed");
  updateUI();
}

updateUI();
</script>

</body>
</html>
